#!/bin/bash
# Autonomous Project Creation Tool (v3.0 - with gh integration)
set -e

if [ -z "$1" ]; then
    echo "Usage: $0 <project_name>"
    exit 1
fi

PROJECT_NAME=$1
TARGET_PATH="projects/$PROJECT_NAME"

if [ -d "$TARGET_PATH" ]; then
    echo "Error: Project $PROJECT_NAME already exists."
    exit 1
fi

echo "ğŸš€ Starting Autonomous Project Creation: $PROJECT_NAME"

# 1. ç‰©ç†ç»“æ„åˆå§‹åŒ–
mkdir -p "$TARGET_PATH/.gemini/tasks"
if [ -f "gemini-scaffold/templates/PROJECT_GEMINI.md" ]; then
    sed "s/{{PROJECT_NAME}}/$PROJECT_NAME/g" gemini-scaffold/templates/PROJECT_GEMINI.md > "$TARGET_PATH/GEMINI.md"
fi
touch "$TARGET_PATH/.gemini/tasks/"{current_task,memory,implementation_plan,walkthrough}.md

# 2. æœ¬åœ°ä»“åº“åˆå§‹åŒ–
cd "$TARGET_PATH"
git init -q
cat > .gitignore <<EOF
/datas/
/reports/
__pycache__/
.DS_Store
EOF
git add .
git commit -m "chore: é¡¹ç›®åˆå§‹åŒ– (Autonomous Start)" -q

# 3. è‡ªåŠ¨åˆ›å»º GitHub ç§æœ‰ä»“åº“ (éœ€è¦ gh å·²ç™»å½•)
if command -v gh &> /dev/null; then
    echo "â˜ï¸  æ­£åœ¨ GitHub ä¸Šåˆ›å»ºç§æœ‰ä»“åº“..."
    gh repo create "$PROJECT_NAME" --private --source=. --remote=origin --push
    echo "âœ“ è¿œç¨‹ç§æœ‰ä»“åº“å·²å»ºç«‹å¹¶åŒæ­¥ã€‚"
else
    echo "âš  GitHub CLI æœªé…ç½®ï¼Œè·³è¿‡è‡ªåŠ¨åˆ›å»ºã€‚è¯·æ‰‹åŠ¨ç»‘å®šè¿œç¨‹ä»“åº“ã€‚"
fi

cd - > /dev/null
echo "------------------------------------------------"
echo "âœ¨ é¡¹ç›® [$PROJECT_NAME] å·²å°±ç»ªï¼"
echo "ç‰©ç†ä½ç½®: $TARGET_PATH"
echo "å®‰å…¨çŠ¶æ€: GitHub Private Repo å·²é”å®š"
echo "------------------------------------------------"
